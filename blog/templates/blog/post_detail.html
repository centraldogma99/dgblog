{% extends 'blog/base.html' %}

{% block content %}
{% load mptt_tags %}
	<script>
		/*
		const $button = document.querySelector('#button');
    	const $form = document.querySelector('#form');
		$button.addEventListener('click', () => {
        	$form.style.display = 'block';
    	});
*/
		var handleClick = function(evt) {
			evt.target.parentNode.parentNode.childNodes[3].style.display = 'block';
    	} ;
		
		window.onload = function(){
			$(".replybtn").bind('click', $.proxy(handleClick, this));
		};
	</script>

	{% if messages %}
		{% for message in messages %}
			<script>alert("{{ message.message }}")</script>
		{% endfor %}
	{% endif %}

    <div class="post">
        {% if user.is_authenticated %}
			{% if post.published_date %}
            <div class="date">
                {{ post.published_date }}
            </div>
			<a class="btn btn-default" href="{% url 'post_unpublish' pk=post.pk %}">Unpublish</a>
		{% else %}
			<a class="btn btn-default" href="{% url 'post_publish' pk=post.pk %}">Publish</a>
        {% endif %}
     		<a class="btn btn-default" href="{% url 'post_edit' pk=post.pk %}"><span class="glyphicon glyphicon-pencil"></span></a>
			<a class="btn btn-default" href="{% url 'post_delete' pk=post.pk %}"><span class="glyphicon glyphicon-remove"></span></a>
		{% endif %}
        <h1>{{ post.title }}</h1>
        <p>{{ post.text|linebreaksbr }}</p>
    </div>
	<hr>
		
	<script>
		function WriteComment(){
			var thef = document.getElementById("commentwin")
			if (thef.style.display == "none"){
				thef.style.display = "block"
			} else {
				thef.style.display = "none"
			}
		}
	</script>
	<a class="btn btn-default" href="javascript:WriteComment()">Write Comment</a>
	<div id="commentBody"></div>
	<form id="commentwin" name="writecomment" method="POST" action="{% url 'comment_write2' pk=post.pk %}" >
		{% csrf_token %}
		<p>
			<label for="author">Username:</label>
            <input type="text" name="author" required id="author">
		</p>
		<textarea name="text" required id="text" cols="100" rows="7"></textarea>
		<button type="submit">Confirm</button>
	</form>
	
<ul id="bigul">
{% recursetree post.comments.all %}
	{% if node.approved or user.is_authenticated %}
	<li>
		<div class="biggerclass">
		<div class="comment">
			<div class="date">{{ node.created_date }}</div>
			{% if not node.approved %}
				<a class="btn btn-default" href="{% url 'comment_remove' commentpk=node.pk %}"><span class="glyphicon glyphicon-remove"></span></a>
                <a class="btn btn-default" href="{% url 'comment_approve' commentpk=node.pk %}"><span class="glyphicon glyphicon-ok"></span></a>
			{% endif %}
			<strong>{{ node.author }}</strong>
			<a class="btn btn-default replybtn" ><span class="glyphicon glyphicon-arrow-down"></span></a>
			<p>{{ node.text|linebreaks }}</p>
		</div>
		<form id="commentwin" name="writecomment" method="POST" action="{% url 'comment_write2' pk=post.pk parent=node.pk %}" style="display:none">
			{% csrf_token %}
			<p>
				<label for="author">Username:</label>
        		<input type="text" name="author" required id="author">
			</p>
			<textarea name="text" required id="text" cols="100" rows="7"></textarea>
			<button type="submit">Confirm</button>
		</form>
		</div>
		{% if not node.is_leaf_node %}
			<ul class="children">
				{{ children }}
			</ul>
		{% endif %}
	</li>
	{% endif %}
{% endrecursetree %}
	




{% endblock %}